"use strict";(self.webpackChunksrcAngular=self.webpackChunksrcAngular||[]).push([[7794],{57794:(S,_,a)=>{a.r(_),a.d(_,{GtwidpModule:()=>j});var f=a(31890),p=a(93075),u=a(69808),h=a(99291),v=a(15861),m=a(40520),x=a(57553),d=a(92340),t=a(87587),b=a(4516),w=a(30424),C=a(14036),y=a(51062);function Z(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"input",49),t.NdJ("change",function(o){t.CHM(e);const r=t.oxw().$implicit;return t.oxw(2).menuChange(o,r)}),t.qZA(),t.TgZ(2,"a",50),t._uU(3),t.ALo(4,"translate"),t._UZ(5,"span",51),t.qZA()()}if(2&i){const e=t.oxw().$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("formControlName",e.key),t.xp6(1),t.uIk("href","#mains"+e.key,t.LSH)("aria-expanded",1===n.apiNodes.length?"true":n.isCollapsed)("aria-controls","mains"+e.key),t.xp6(1),t.hij(" ",n.isValidStringStartWith_dp_(e.vgroupAliasShowUi)?t.lcZ(4,5,"all"):e.vgroupAliasShowUi+"("+e.vgroupId+")","")}}function A(i,l){if(1&i&&(t.TgZ(0,"div")(1,"label",57),t._uU(2),t.qZA()()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("for",e.apiDesc),t.xp6(1),t.hij(" ",e.apiDesc," ")}}function O(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"div",54)(1,"input",55),t.NdJ("change",function(o){const s=t.CHM(e).$implicit;return t.oxw(4).menuChange(o,s)}),t.qZA(),t.TgZ(2,"label",56),t._uU(3),t.qZA(),t.YNc(4,A,3,2,"div",47),t.qZA()}if(2&i){const e=l.$implicit;t.xp6(1),t.Q6J("id",e.key)("formControlName",e.key),t.xp6(1),t.Q6J("for",e.key),t.xp6(1),t.AsE(" ",e.apiNameShowUi," (",e.groupId,")"),t.xp6(1),t.Q6J("ngIf",e.apiDesc)}}const T=function(i){return{show:i}};function k(i,l){if(1&i&&(t.TgZ(0,"div",52),t.YNc(1,O,5,6,"div",53),t.qZA()),2&i){const e=t.oxw().$implicit,n=t.oxw(2);t.Q6J("id","mains"+e.key)("ngClass",t.VKq(3,T,1===n.apiNodes.length)),t.xp6(1),t.Q6J("ngForOf",e.apiDataList)}}function N(i,l){if(1&i&&(t.TgZ(0,"ul",44)(1,"li",45)(2,"div",46),t.YNc(3,Z,6,7,"div",47),t.qZA(),t.YNc(4,k,2,5,"div",48),t._UZ(5,"hr"),t.qZA()()),2&i){const e=l.$implicit;t.xp6(3),t.Q6J("ngIf",e.apiDataList&&e.apiDataList.length>0),t.xp6(1),t.Q6J("ngIf",e.apiDataList&&e.apiDataList.length>0)}}const M=function(){return{width:"100%"}},U=function(i){return{title:i}};function $(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"form",3),t.NdJ("ngSubmit",function(){return t.CHM(e),t.oxw().submitForm()}),t.TgZ(3,"div",4)(4,"h1",5),t._UZ(5,"img",6),t._uU(6),t.qZA()(),t._UZ(7,"hr"),t.TgZ(8,"div",7)(9,"div",8)(10,"label"),t._uU(11),t.ALo(12,"translate"),t.qZA()(),t.TgZ(13,"div",9)(14,"div",10)(15,"label",11),t._uU(16),t.ALo(17,"translate"),t.qZA(),t._UZ(18,"input",12)(19,"p-dropdown",13),t.qZA(),t.TgZ(20,"div",14)(21,"label",15),t._uU(22),t.ALo(23,"translate"),t.qZA(),t.TgZ(24,"div",16)(25,"span",17),t._UZ(26,"img",18),t.qZA(),t._UZ(27,"input",19,20),t.ALo(29,"translate"),t.qZA()(),t.TgZ(30,"div",14)(31,"label",15),t._uU(32),t.ALo(33,"translate"),t.qZA(),t.TgZ(34,"div",16)(35,"span",17),t._UZ(36,"img",21),t.qZA(),t._UZ(37,"input",22),t.ALo(38,"translate"),t.qZA()(),t.TgZ(39,"div",23)(40,"button",24),t._uU(41),t.ALo(42,"translate"),t.qZA()()()()(),t.TgZ(43,"form",25)(44,"div",26)(45,"div",27)(46,"div",28),t.YNc(47,N,6,2,"ul",29),t.qZA()()()(),t.TgZ(48,"div",30)(49,"p"),t._uU(50),t.ALo(51,"translate"),t.qZA(),t.TgZ(52,"div",31)(53,"button",32),t.NdJ("click",function(){return t.CHM(e),t.oxw().apiConfirm()}),t._uU(54),t.ALo(55,"translate"),t.qZA(),t.TgZ(56,"button",33),t.NdJ("click",function(){return t.CHM(e),t.oxw().apiCancel()}),t._uU(57),t.ALo(58,"translate"),t.qZA()()()(),t.TgZ(59,"div",34)(60,"div",35),t._UZ(61,"img",36),t.qZA(),t.TgZ(62,"div",37)(63,"div",38)(64,"section",39),t._UZ(65,"img",40),t.TgZ(66,"div",41)(67,"label"),t._uU(68),t.qZA()(),t.TgZ(69,"button",42),t.NdJ("click",function(){return t.CHM(e),t.oxw().returnToLogin()}),t._uU(70),t.ALo(71,"translate"),t.qZA()()()(),t.TgZ(72,"footer",43)(73,"span"),t._uU(74,"Copyright\xa9 TPIsoftware. All Rights Reserved."),t.qZA()()()()}if(2&i){const e=t.oxw();t.xp6(2),t.Q6J("formGroup",e.form),t.xp6(3),t.Q6J("src",e.imgSrc,t.LSH),t.xp6(1),t.hij(" ",e.title," "),t.xp6(3),t.Q6J("hidden","consent"==e.path.action)("hidden","LDAP"!==e.idpType),t.xp6(2),t.Oqu(t.lcZ(12,27,"adldap_login")),t.xp6(2),t.Q6J("hidden","consent"==e.path.action),t.xp6(1),t.Q6J("hidden","consent"!=e.path.action),t.xp6(2),t.Oqu(t.lcZ(17,29,"authority_time")),t.xp6(3),t.Akn(t.DdM(50,M)),t.Q6J("options",e.timeUnit),t.xp6(3),t.Oqu(t.lcZ(23,31,"user_name")),t.xp6(5),t.Q6J("placeholder",t.lcZ(29,33,"user_name")),t.xp6(5),t.Oqu(t.lcZ(33,35,"user_password")),t.xp6(5),t.Q6J("placeholder",t.lcZ(38,37,"user_password")),t.xp6(4),t.hij(" ",t.lcZ(42,39,"login")," "),t.xp6(2),t.Q6J("formGroup",e.formApi),t.xp6(1),t.Q6J("hidden","consent"!=e.path.action),t.xp6(3),t.Q6J("ngForOf",e.apiNodes),t.xp6(1),t.Q6J("hidden","consent"!=e.path.action),t.xp6(2),t.Oqu(t.xi3(51,41,"gtwidp_alert",t.VKq(51,U,e.title))),t.xp6(4),t.hij(" ",t.lcZ(55,44,"button.confirm")," "),t.xp6(3),t.hij(" ",t.lcZ(58,46,"button.cancel")," "),t.xp6(2),t.Q6J("hidden","errMsg"!==e.path.type),t.xp6(9),t.Oqu(e.msg),t.xp6(2),t.hij(" ",t.lcZ(71,48,"button.return")," ")}}const L=[{path:"",component:(()=>{class i{constructor(e,n,o,r,s){this.fb=e,this.httpClient=n,this.route=o,this.toolService=r,this.api=s,this.title="",this.imgSrc="",this.idpType="LDAP",this.paramsObj={},this.path={},this.accessTokenValidity=0,this.apiNodes=[],this.timeUnit=[],this.msg="Loading...",this.btnDisabled=!0,this.processShow=!0,this.isCollapsed=!0,this.show=!1}ngOnInit(){var e=this;return(0,v.Z)(function*(){e.show=!1,e.formApi=e.fb.group([]),e.form=e.fb.group({uname:new p.NI(""),mima:new p.NI(""),timeUnit:new p.NI,validityTime:new p.NI({value:"",disabled:!0})}),e.route.params.subscribe(r=>{e.path=r}),e.route.queryParams.subscribe(r=>{e.paramsObj=r});const o=yield e.toolService.getDict(["token_exp_time_options.day","token_exp_time_options.hour","token_exp_time_options.minute","token_exp_time_options.second"]);e.timeUnit=[{label:o["token_exp_time_options.day"],value:"86400"},{label:o["token_exp_time_options.hour"],value:"3600"},{label:o["token_exp_time_options.minute"],value:"60"},{label:o["token_exp_time_options.second"],value:"1"}],"errMsg"!=e.path.type?(e.idpType=e.path.type,e.getTitle(),e.getIcon(),"consent"==e.path.action?e.getVgroupList():e.show=!0):(e.show=!0,e.msg=e.toolService.Base64Decoder(e.paramsObj.msg))})()}getTitle(){let e="";e="localhost"==location.hostname||"127.0.0.1"==location.hostname?d.N.apiUrl:`${location.protocol}//${location.hostname}:${location.port}`,e+=`/dgrv4/ssotoken/gtwidp/${this.idpType}/getTitle?client_id=${this.paramsObj.client_id}`;let n=new m.WM;this.httpClient.get(`${e}`,{headers:n,observe:"response",responseType:"text"}).subscribe(o=>{var r;this.title=null!==(r=o.body)&&void 0!==r?r:""})}getIcon(){let e="";e="localhost"==location.hostname||"127.0.0.1"==location.hostname?d.N.apiUrl:`${location.protocol}//${location.hostname}:${location.port}`,e+=`/dgrv4/ssotoken/gtwidp/${this.idpType}/getIcon?client_id=${this.paramsObj.client_id}`;let n=new m.WM;this.httpClient.get(`${e}`,{headers:n,observe:"response",responseType:"text"}).subscribe(o=>{var r;this.imgSrc=null!==(r=o.body)&&void 0!==r?r:""})}getVgroupList(){let e="";e="localhost"==location.hostname||"127.0.0.1"==location.hostname?d.N.apiUrl:`${location.protocol}//${location.hostname}:${location.port}`,e+=`/dgrv4/ssotoken/gtwidp/${this.idpType}/getVgroupList?client_id=${this.paramsObj.client_id}&redirect_uri=${this.paramsObj.redirect_uri}`;let n=new m.WM;this.httpClient.get(`${e}`,{headers:n,observe:"response",responseType:"text"}).subscribe(o=>{var r;try{this.vgroupList=JSON.parse(JSON.parse(JSON.stringify(o.body))),this.apiNodes=this.vgroupList.vgroupDataList,this.apiNodes=this.apiNodes.map((s,c)=>(s.key=`p.${c}`,this.formApi.addControl(s.key,new p.NI(!1)),s.apiDataList.forEach((g,G)=>{g.parentId=s.key,g.key=`${s.key}_${G}`,this.formApi.addControl(g.key,new p.NI(!1))}),s)),this.form.get("timeUnit").valueChanges.subscribe(s=>{var c;let g=this.vgroupList.refreshTokenValidity/s;null===(c=this.form.get("validityTime"))||void 0===c||c.setValue(g)}),null===(r=this.form.get("timeUnit"))||void 0===r||r.setValue("86400"),0==this.apiNodes.length||1==this.apiNodes.length&&this.isValidStringStartWith_dp_(this.apiNodes[0].vgroupAliasShowUi)&&0==this.apiNodes[0].apiDataList.length?this.apiConfirm():(this.isValidStringStartWith_dp_(this.apiNodes[0].vgroupAliasShowUi)&&(this.isCollapsed=!1),this.show=!0)}catch(s){this.show=!0}})}isValidStringStartWith_dp_(e){return/^dp_\d{19}$/.test(e)}submitForm(){let e={ReqHeader:this.api.getReqHeader(x.Nx.dataEncryption),ReqBody:{dataMap:{password:this.mima.value,username:this.uname.value}}};this.httpClient.post(`${d.N.apiUrl}/dgrv4/ssotoken/jweEncryption`,e,{observe:"response",headers:{"Content-Type":"application/json",digiRunner:"ldap process"}}).subscribe(o=>{if((null==o?void 0:o.body)&&""!==(null==o?void 0:o.body)){let s=`${d.N.apiUrl}/dgrv4/ssotoken/gtwidp/${this.idpType}/gtwlogin?credential=${o.body.RespBody.ciphertext}`;Object.keys(this.paramsObj).map(c=>{s+=`&${c}=${this.paramsObj[c]}`}),window.location.href=s}})}menuChange(e,n){if(n.apiDataList)n.apiDataList.forEach(o=>{this.formApi.controls[o.key].setValue(e.target.checked)});else{let o=this.apiNodes.filter(s=>s.key==n.parentId),r=o[0].apiDataList.every(s=>1==this.formApi.controls[s.key].value);this.formApi.controls[o[0].key].setValue(r)}}apiConfirm(){let e=new Array;Object.keys(this.formApi.controls).filter(o=>{o.indexOf("_")>-1&&1==this.formApi.controls[o].value&&this.apiNodes.forEach(r=>{r.apiDataList.forEach(s=>{s.key===o&&e.push(s.groupId)})})});let n=`${d.N.apiUrl}/dgrv4/ssotoken/gtwidp/${this.idpType}/approve?username=${this.paramsObj.username}&redirect_uri=${this.paramsObj.redirect_uri}&state=${this.paramsObj.state}&scope=${e.join("%20")}`;window.location.href=n}apiCancel(){window.location.href=`${this.paramsObj.redirect_uri}?rtn_code=cancel&msg=VXNlciBwcmVzc2VzIGNhbmNlbA`}returnToLogin(){window.location.href=`${this.paramsObj.redirect_uri}?rtn_code=error&msg=${this.paramsObj.msg}`}get uname(){return this.form.get("uname")}get mima(){return this.form.get("mima")}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(p.qu),t.Y36(m.eN),t.Y36(h.gz),t.Y36(b.g),t.Y36(w.K))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-gtwidp"]],decls:1,vars:1,consts:[["class","login-center-page",4,"ngIf"],[1,"login-center-page"],[1,"form-wrapper"],[3,"formGroup","ngSubmit"],[1,"form-header"],[2,"font-weight","bold"],[3,"src"],[1,"form-body"],[1,"line",3,"hidden"],[1,"form-area",3,"hidden"],[1,"field-flex-start",3,"hidden"],[1,"mb-0"],["type","text","formControlName","validityTime",1,"form-control",2,"width","100px"],["formControlName","timeUnit",3,"options"],[1,"input-line"],["for","uname"],[1,"input-sign-wrapper"],[1,"sign"],["src","assets/images/login/i_user.png","alt","number"],["type","text","formControlName","uname",1,"form-control",3,"placeholder"],["username",""],["src","assets/images/login/i_pwd.png","alt","number"],["type","password","formControlName","mima",1,"form-control",3,"placeholder"],[1,"btn-row"],["type","submit",1,"btn","btn-login"],[3,"formGroup"],[1,"col-12","row","mx-0","px-0",3,"hidden"],[1,"row",2,"display","block","width","inherit"],[1,"col"],["class","list-group list-group-flush",4,"ngFor","ngForOf"],[1,"p-2","mx-5",3,"hidden"],[1,"field-flex-center"],["type","button",1,"btn","tpi-btn","tpi-primary",3,"click"],["type","button",1,"btn","tpi-btn","tpi-night",3,"click"],[1,"login-page",2,"position","absolute","top","0","left","0","background","white",3,"hidden"],[1,"image-panel"],["src","assets/images/img_login_visual.png",1,"img-building"],[1,"loading-panel"],[2,"width","380px"],[1,"loading-section"],["src","assets/images/svg/logo.svg","alt","","title","v202102251030-v3",1,"img-logo"],[1,"line"],["type","button",1,"btn","btn-login",3,"click"],[1,"login-footer"],[1,"list-group","list-group-flush"],[1,"list-group-item","px-2"],[1,"checkbox"],[4,"ngIf"],["class","collapse show",3,"id","ngClass",4,"ngIf"],["type","checkbox","value","",3,"formControlName","change"],["data-bs-toggle","collapse","role","button",1,"btn","collapsed"],[1,"me-3"],[1,"collapse","show",3,"id","ngClass"],["class","form-check","class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],["type","checkbox",1,"form-check-input",2,"margin-top",".1em",3,"id","formControlName","change"],[1,"form-check-label",2,"margin-left","10px","margin-top","3px",3,"for"],[1,"form-check-label",3,"for"]],template:function(e,n){1&e&&t.YNc(0,$,75,53,"div",0),2&e&&t.Q6J("ngIf",n.show)},directives:[u.O5,p._Y,p.JL,p.sg,p.Fj,p.JJ,p.u,C.Lt,u.sg,p.Wl,u.mk],pipes:[y.X$],styles:[".btn[_ngcontent-%COMP%]{box-shadow:none!important;outline:0}a[_ngcontent-%COMP%]:link, a[_ngcontent-%COMP%]:visited, .list-group-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#5a5541}a[_ngcontent-%COMP%]:hover, a[_ngcontent-%COMP%]:focus{color:orange}.list-group-item[_ngcontent-%COMP%]{margin-left:2rem;padding-top:10px!important;border:0px}hr[_ngcontent-%COMP%]{margin-bottom:0;margin-top:0}a[_ngcontent-%COMP%]{width:95%;text-align:left}.list-group-item[_ngcontent-%COMP%]{margin-left:2rem;padding-top:10px!important;border:0px;background:#f6f6f6}.list-group-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{border:solid #222;border-width:0 1px 1px 0;display:inline;cursor:pointer;padding:3px;position:absolute;right:0}.list-group-item[_ngcontent-%COMP%]   a.btn.collapsed[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{transform:rotate(40deg);-webkit-transform:rotate(40deg);transition:.2s transform ease-in-out}.list-group-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{margin-bottom:5px;padding-left:10px}.list-group-item[_ngcontent-%COMP%]   a.btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{transform:rotate(-140deg);-webkit-transform:rotate(-140deg);transition:.2s transform ease-in-out}.list-group-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{cursor:pointer;appearance:none;background:#fff;border-radius:1px;box-sizing:border-box;position:relative;box-sizing:content-box;border:1px solid orange;width:20px;height:20px;transition:all .2s linear}.list-group-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked{background-color:#ea7448}.list-group-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:focus{outline:0 none;box-shadow:none}.list-group-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:disabled{border:1px solid #959595}.list-group-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked:disabled{background-color:#959595}"]}),i})()}];let J=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[h.Bz.forChild(L)],h.Bz]}),i})();var P=a(78555);let j=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[u.ez,p.u5,p.UX,f.m,J,P.W]]}),i})()}}]);